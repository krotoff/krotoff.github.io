<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gig Pager App</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      overflow: hidden;
    }
    .swiper {
      width: 100vw;
      height: 100vh;
    }
    .swiper-slide {
      box-sizing: border-box;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
      text-align: center;
      overflow-y: auto;
    }
    .background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-size: cover;
      background-position: center;
      z-index: 0;
    }
    .background::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
    }
    .content {
      position: relative;
      z-index: 1;
      width: 100%;
    }
    img.cover {
      max-width: 100%;
      max-height: 40vh;
      object-fit: contain;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .song-info {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .progress {
      position: relative;
      width: 100%;
      max-width: 500px;
      background: transparent;
      height: 4px;
      border-radius: 2px;
      margin-bottom: 10px;
    }
    .progress-bar {
      height: 100%;
      background: rgba(255, 255, 255, 0.5);
      width: 100%;
      border-radius: 2px;
    }
    .progress::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #fff;
    }
    .instruments {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 20px 0;
      width: 100%;
      max-width: 600px;
      text-align: left;
    }
    .footer-next {
      margin-top: 20px;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .setlist {
      text-align: left;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <div class="swiper">
    <div class="swiper-wrapper" id="swiper-wrapper">
      <!-- Slides inserted here -->
    </div>
    <div class="swiper-pagination"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    const EMOJIS = {
      'Vocal 1': 'üé§',
      'Vocal 2': 'üé§',
      'Vocal 3': 'üé§',
      'Guitar 1': 'üé∏',
      'Guitar 2': 'üé∏',
      'Bass': 'üé∏',
      'Drums': 'ü•Å',
      'Keyboard': 'üéπ',
      'Additional Tool 1': 'üß∞',
      'Additional Tool 2': 'üß∞'
    };

    const loadCSV = () => {
      Papa.parse('data.csv', {
        download: true,
        header: true,
        complete: function(results) {
          buildSlides(results.data);
        }
      });
    };

    function buildSlides(data) {
      const wrapper = document.getElementById('swiper-wrapper');

      const introSlides = [
        `<div class="swiper-slide">
          <div class="content">
            <h1>Welcome to the Gig App üé∂</h1>
            <p>Swipe to navigate through the performance</p>
          </div>
        </div>`,
        `<div class="swiper-slide">
          <div class="content">
            <h2>Setlist</h2>
            <div class="setlist">
              ${data.map(d => `<div>${d.Band} ‚Äî <strong>${d.Song}</strong></div>`).join('')}
            </div>
          </div>
        </div>`
      ];
      wrapper.innerHTML += introSlides.join('');

      data.forEach(song => {
        if (!song.id) return;
        const instruments = Object.keys(EMOJIS)
          .filter(key => song[key])
          .map(key => `<div>${EMOJIS[key]} <strong>${key}</strong>: ${song[key]}</div>`) 
          .join('');

        const progressBar = song.Duration ? 
          `<div class="progress"><div class="progress-bar" style="width: 100%"></div></div>
           <div>${song.Duration}</div>` : '';

        const nextSong = data.find(s => s.id === song['Next song']);
        const nextFooter = nextSong ? `
          <div class="footer-next">
            ‚è≠Ô∏è Next: ${nextSong.Band} ‚Äî <strong>${nextSong.Song}</strong>
            ${nextSong.Cover ? `<br><img src="${nextSong.Cover}" style="height:50px; border-radius:6px; margin-top:5px;">` : ''}
          </div>` : '';

        wrapper.innerHTML += `
          <div class="swiper-slide">
            ${song.Cover ? `<div class="background" style="background-image: url('${song.Cover}');"></div>` : ''}
            <div class="content">
              ${song.Cover ? `<img src="${song.Cover}" class="cover">` : ''}
              <div class="song-info">
                #${song.id}: ${song.Band} ‚Äî <strong>${song.Song}</strong>
              </div>
              ${progressBar}
              <div class="instruments">
                ${instruments}
              </div>
              ${nextFooter}
            </div>
          </div>`;
      });

      new Swiper('.swiper', {
        pagination: { el: '.swiper-pagination' },
        spaceBetween: 30,
        centeredSlides: true
      });
    }

    loadCSV();
  </script>
</body>
</html>
